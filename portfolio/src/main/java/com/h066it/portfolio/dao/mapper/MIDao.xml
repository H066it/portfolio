<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.h066it.portfolio.dao.IDao">

	<!-- freeBoard #1 nav -->

	<select id="count" resultType="com.h066it.portfolio.dto.Dto"
		parameterType="com.h066it.portfolio.vo.PageVo">
		SELECT * FROM freeBoard ORDER BY bId DESC
	</select>

	<select id="list" resultType="com.h066it.portfolio.dto.Dto"
		parameterType="com.h066it.portfolio.vo.PageVo">
		SELECT S.bId, S.bWriter, S.bTitle, S.bContent, S.bDate, S.bCount
		FROM (SELECT rownum AS rnum, F.bId, F.bWriter, F.bTitle, F.bContent, F.bDate, F.bCount
				FROM (SELECT bId, bWriter, bTitle, bContent, bDate, bCount
						FROM freeBoard ORDER BY bId DESC) F
						WHERE rownum <![CDATA[<=]]> #{lstNum}) S
		WHERE S.rnum <![CDATA[>=]]> #{firNum}		
	</select>

	<insert id="write">
		INSERT INTO freeBoard (gId, bId, bWriter, bTitle, bContent, bCount)
		VALUES (1, freeBoard_seq.nextval, #{bWriter}, #{bTitle}, #{bContent}, 0)
	</insert>

	<delete id="delete">
		DELETE FROM freeBoard WHERE bId = #{bId}
	</delete>

	<select id="view" resultType="com.h066it.portfolio.dto.Dto">
		SELECT * FROM freeBoard WHERE bId =	#{bId}
	</select>

	<update id="update">
		UPDATE freeBoard
		SET bWriter = #{bWriter}, bTitle = #{bTitle}, bContent = #{bContent}
		WHERE bId = #{bId}
	</update>

	<update id="countUpdate">
		UPDATE freeBoard SET bCount = bCount + 1 WHERE bId = #{bId}
	</update>


	<select id="searchCount" resultType="com.h066it.portfolio.dto.Dto" parameterType="com.h066it.portfolio.vo.PageVo">
		SELECT * FROM freeBoard WHERE
		<if test="searchType.equals('bTitle')">bTitle LIKE '%'||#{keyword}||'%'</if>
		<if test="searchType.equals('bContent')">bContent LIKE '%'||#{keyword}||'%'</if>
		<if test="searchType.equals('bTitle_bContent')">bTitle LIKE '%'||#{keyword}||'%' OR bContent LIKE
			'%'||#{keyword}||'%'</if>
		<if test="searchType.equals('bWriter')">bWriter LIKE '%'||#{keyword}||'%'</if>
		ORDER BY bId DESC
	</select>

	<select id="searchList" resultType="com.h066it.portfolio.dto.Dto" parameterType="com.h066it.portfolio.vo.PageVo">
		SELECT S.bId, S.bWriter, S.bTitle, S.bContent, S.bDate, S.bCount
		FROM (SELECT rownum AS rnum, F.bId, F.bWriter, F.bTitle, F.bContent, F.bDate, F.bCount
				FROM (SELECT bId, bWriter, bTitle, bContent, bDate, bCount
						FROM freeBoard ORDER BY bId DESC) F
						WHERE 
						<if test="searchType.equals('bTitle')">bTitle LIKE '%'||#{keyword}||'%'</if>
						<if test="searchType.equals('bContent')">bContent LIKE '%'||#{keyword}||'%'</if>
						<if test="searchType.equals('bTitle_bContent')">bTitle LIKE '%'||#{keyword}||'%' OR bContent LIKE
						'%'||#{keyword}||'%'</if>
						<if test="searchType.equals('bWriter')">bWriter LIKE '%'||#{keyword}||'%'</if>
						AND rownum <![CDATA[<=]]> #{lstNum}) S
		WHERE S.rnum <![CDATA[>=]]> #{firNum}
	</select>
	
	
	<insert id="fileWrite" parameterType="com.h066it.portfolio.dto.Dto">
		<selectKey keyProperty="bId" resultType="Integer" order="BEFORE">
			SELECT MAX(bId) FROM freeBoard
		</selectKey>
		INSERT INTO freeBoard_file (fId, gId, bId, fName, rName, fSize)
		VALUES (freeboard_file_seq.nextval, 1, #{bId} , #{fName}, #{rName}, #{fSize})
	</insert>

	<delete id="fileDelete">
		DELETE FROM freeBoard_file WHERE fId = #{fId}
	</delete>

	<select id="fileView" resultType="com.h066it.portfolio.dto.FileDto" parameterType="String">
		SELECT * FROM freeBoard_file WHERE bId = #{bId}
	</select>

</mapper>